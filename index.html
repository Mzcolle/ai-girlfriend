<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoveAI - Sua Namorada Virtual</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }

        .floating-text {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            opacity: 0.7;
            animation: float 15s infinite linear;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .screen {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            font-size: 3em;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        .plan-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .plan-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .plan-price {
            font-size: 2em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .plan-features {
            list-style: none;
            text-align: left;
        }

        .plan-features li {
            padding: 5px 0;
            color: #666;
        }

        .plan-features li:before {
            content: "‚úì ";
            color: #4CAF50;
            font-weight: bold;
        }

        .premium-badge {
            position: absolute;
            top: -10px;
            right: 15px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .chat-container {
            max-width: 800px;
            width: 100%;
            height: 80vh;
            background: white;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .girlfriend-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .girlfriend-status {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 20px;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.ai .message-bubble {
            background: white;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .usage-meter {
            background: #f0f0f0;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .usage-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .usage-fill {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s ease;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .screen {
                padding: 25px;
            }
            
            .chat-container {
                height: 90vh;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Text Animation -->
    <div id="floatingText"></div>

    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="screen active">
            <div class="logo">üíï LoveAI</div>
            <p class="subtitle">Sua namorada virtual com intelig√™ncia artificial</p>
            <button class="btn" onclick="showScreen('loginScreen')">Entrar</button>
            <button class="btn btn-outline" onclick="showScreen('registerScreen')">Criar Conta</button>
        </div>

        <!-- Register Screen -->
        <div id="registerScreen" class="screen">
            <button class="back-btn" onclick="showScreen('welcomeScreen')">‚Üê Voltar</button>
            <div class="logo">üíï Criar Conta</div>
            <form id="registerForm">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label>E-mail</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <div class="form-group">
                    <label>Idade</label>
                    <input type="number" id="registerAge" min="18" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirmar Senha</label>
                    <input type="password" id="registerPasswordConfirm" required minlength="6">
                </div>
                <button type="submit" class="btn">Criar Conta</button>
            </form>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="screen">
            <button class="back-btn" onclick="showScreen('welcomeScreen')">‚Üê Voltar</button>
            <div class="logo">üíï Entrar</div>
            <form id="loginForm">
                <div class="form-group">
                    <label>E-mail</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn">Entrar</button>
            </form>
        </div>

        <!-- Email Verification Screen -->
        <div id="verificationScreen" class="screen">
            <div class="logo">üìß Verificar E-mail</div>
            <p class="subtitle">Enviamos um c√≥digo de verifica√ß√£o para seu e-mail</p>
            <form id="verificationForm">
                <div class="form-group">
                    <label>C√≥digo de Verifica√ß√£o</label>
                    <input type="text" id="verificationCode" maxlength="6" required>
                </div>
                <button type="submit" class="btn">Verificar</button>
                <button type="button" class="btn btn-outline" onclick="resendVerification()">Reenviar C√≥digo</button>
            </form>
        </div>

        <!-- Plan Selection Screen -->
        <div id="planScreen" class="screen">
            <div class="logo">üí∞ Escolha seu Plano</div>
            <p class="subtitle">Selecione o plano ideal para voc√™</p>
            
            <div class="plan-card" onclick="selectPlan('free')">
                <div class="plan-title">Plano Free</div>
                <div class="plan-price">Gr√°tis</div>
                <ul class="plan-features">
                    <li>At√© 12 horas di√°rias de conversa</li>
                    <li>Personaliza√ß√£o b√°sica da namorada</li>
                    <li>Conversas com IA</li>
                </ul>
            </div>

            <div class="plan-card" onclick="selectPlan('vip')">
                <div class="premium-badge">POPULAR</div>
                <div class="plan-title">Plano VIP</div>
                <div class="plan-price">R$ 19,99</div>
                <ul class="plan-features">
                    <li>Conversas ilimitadas</li>
                    <li>Personaliza√ß√£o avan√ßada</li>
                    <li>Suporte priorit√°rio</li>
                    <li>Funcionalidades exclusivas</li>
                </ul>
            </div>

            <button id="continuePlan" class="btn" style="display: none;" onclick="proceedWithPlan()">Continuar</button>
        </div>

        <!-- Payment Screen -->
        <div id="paymentScreen" class="screen">
            <button class="back-btn" onclick="showScreen('planScreen')">‚Üê Voltar</button>
            <div class="logo">üí≥ Pagamento</div>
            <p class="subtitle">Plano VIP - R$ 19,99/m√™s</p>
            
            <div class="form-group">
                <label>M√©todo de Pagamento</label>
                <select id="paymentMethod" onchange="togglePaymentFields()">
                    <option value="">Selecione</option>
                    <option value="pix">PIX</option>
                    <option value="card">Cart√£o de Cr√©dito</option>
                </select>
            </div>

            <div id="pixPayment" style="display: none;">
                <div class="success-message">
                    <strong>PIX Gerado!</strong><br>
                    C√≥digo: 00020126580014br.gov.bcb.pix...<br>
                    Valor: R$ 19,99<br>
                    <small>V√°lido por 30 minutos</small>
                </div>
                <button class="btn" onclick="confirmPayment()">Confirmar Pagamento</button>
            </div>

            <div id="cardPayment" style="display: none;">
                <div class="form-group">
                    <label>N√∫mero do Cart√£o</label>
                    <input type="text" id="cardNumber" placeholder="0000 0000 0000 0000">
                </div>
                <div style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label>Validade</label>
                        <input type="text" id="cardExpiry" placeholder="MM/AA">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>CVV</label>
                        <input type="text" id="cardCvv" placeholder="000">
                    </div>
                </div>
                <div class="form-group">
                    <label>Nome no Cart√£o</label>
                    <input type="text" id="cardName" placeholder="Nome como no cart√£o">
                </div>
                <button class="btn" onclick="processCardPayment()">Processar Pagamento</button>
            </div>
        </div>

        <!-- Girlfriend Setup Screen -->
        <div id="setupScreen" class="screen">
            <div class="logo">üíñ Configure sua Namorada</div>
            <p class="subtitle">Personalize sua companheira virtual</p>
            
            <form id="setupForm">
                <div class="form-group">
                    <label>Nome da sua Namorada</label>
                    <input type="text" id="girlfriendName" required placeholder="Ex: Ana, Julia, Sophia...">
                </div>
                <div class="form-group">
                    <label>Idade</label>
                    <input type="number" id="girlfriendAge" min="18" max="50" required>
                </div>
                <div class="form-group">
                    <label>Profiss√£o</label>
                    <input type="text" id="girlfriendJob" required placeholder="Ex: M√©dica, Professora, Artista...">
                </div>
                <div class="form-group">
                    <label>Caracter√≠sticas e Personalidade</label>
                    <textarea id="girlfriendPersonality" required placeholder="Descreva como ela √©: personalidade, gostos, hobbies, jeito de ser, caracter√≠sticas f√≠sicas..."></textarea>
                </div>
                <button type="submit" class="btn">Criar Namorada</button>
            </form>
        </div>

        <!-- Chat Screen -->
        <div id="chatScreen" class="screen" style="max-width: 800px; padding: 0;">
            <div class="chat-container">
                <div class="chat-header">
                    <button class="back-btn" onclick="showScreen('setupScreen')" style="position: static; margin-bottom: 10px;">‚Üê Configura√ß√µes</button>
                    <div class="girlfriend-name" id="chatGirlfriendName">Ana</div>
                    <div class="girlfriend-status">Online ‚Ä¢ Digitando...</div>
                </div>
                
                <div id="usageMeter" class="usage-meter" style="display: none;">
                    <div>Tempo usado hoje: <span id="usageText">2h 30min / 12h</span></div>
                    <div class="usage-bar">
                        <div class="usage-fill" id="usageFill" style="width: 20%"></div>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-bubble">
                            Oi amor! Sou sua namorada virtual üòç Como foi seu dia?
                        </div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="messageInput" placeholder="Digite sua mensagem..." onkeypress="handleKeyPress(event)">
                    <button class="send-btn" onclick="sendMessage()">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database simulation with localStorage
        class Database {
            static users = JSON.parse(localStorage.getItem('loveai_users') || '{}');
            static sessions = JSON.parse(localStorage.getItem('loveai_sessions') || '{}');
            static girlfriends = JSON.parse(localStorage.getItem('loveai_girlfriends') || '{}');

            static saveUsers() {
                localStorage.setItem('loveai_users', JSON.stringify(this.users));
            }

            static saveSessions() {
                localStorage.setItem('loveai_sessions', JSON.stringify(this.sessions));
            }

            static saveGirlfriends() {
                localStorage.setItem('loveai_girlfriends', JSON.stringify(this.girlfriends));
            }

            static createUser(userData) {
                const id = Date.now().toString();
                this.users[id] = {
                    ...userData,
                    id,
                    verified: false,
                    plan: null,
                    createdAt: new Date().toISOString()
                };
                this.saveUsers();
                return id;
            }

            static verifyUser(userId) {
                if (this.users[userId]) {
                    this.users[userId].verified = true;
                    this.saveUsers();
                    return true;
                }
                return false;
            }

            static updateUserPlan(userId, plan) {
                if (this.users[userId]) {
                    this.users[userId].plan = plan;
                    this.saveUsers();
                    return true;
                }
                return false;
            }

            static createGirlfriend(userId, girlfriendData) {
                this.girlfriends[userId] = {
                    ...girlfriendData,
                    userId,
                    createdAt: new Date().toISOString()
                };
                this.saveGirlfriends();
            }

            static getGirlfriend(userId) {
                return this.girlfriends[userId];
            }
        }

        // Current user session
        let currentUser = null;
        let selectedPlan = null;
        let dailyUsage = JSON.parse(localStorage.getItem('daily_usage') || '{}');
        let chatHistory = JSON.parse(localStorage.getItem('chat_history') || '[]');

        // Floating text animation
        function createFloatingText() {
            const names = ['Ana', 'Julia', 'Sofia', 'Carla', 'Marina', 'Beatriz', 'Fernanda', 'Isabela'];
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            setInterval(() => {
                const text = document.createElement('div');
                text.className = 'floating-text';
                text.textContent = names[Math.floor(Math.random() * names.length)];
                text.style.left = Math.random() * 100 + '%';
                text.style.color = colors[Math.floor(Math.random() * colors.length)];
                text.style.fontSize = (Math.random() * 20 + 15) + 'px';
                
                document.getElementById('floatingText').appendChild(text);
                
                setTimeout(() => {
                    if (text.parentNode) {
                        text.parentNode.removeChild(text);
                    }
                }, 15000);
            }, 1000);
        }

        // Screen navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Form handlers
        function handleRegister(event) {
            event.preventDefault();
            
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            if (password !== passwordConfirm) {
                showMessage('As senhas n√£o coincidem!', 'error');
                return;
            }
            
            const email = document.getElementById('registerEmail').value;
            
            // Check if email already exists
            const existingUser = Object.values(Database.users).find(u => u.email === email);
            if (existingUser) {
                showMessage('Este e-mail j√° est√° cadastrado!', 'error');
                return;
            }
            
            const userData = {
                name: document.getElementById('registerName').value,
                email: email,
                phone: document.getElementById('registerPhone').value,
                age: document.getElementById('registerAge').value,
                password: password // In production, hash this password!
            };

            const userId = Database.createUser(userData);
            currentUser = { ...userData, id: userId };
            
            // Generate verification code
            const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            localStorage.setItem('verification_code', verificationCode);
            localStorage.setItem('pending_user_id', userId);
            
            console.log('C√≥digo de verifica√ß√£o:', verificationCode); // For testing
            
            showMessage('C√≥digo de verifica√ß√£o enviado para seu e-mail! (Confira no console)', 'success');
            showScreen('verificationScreen');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Find user by email
            const user = Object.values(Database.users).find(u => u.email === email);
            if (!user) {
                showMessage('E-mail n√£o encontrado!', 'error');
                return;
            }
            
            if (user.password !== password) {
                showMessage('Senha incorreta!', 'error');
                return;
            }
            
            if (!user.verified) {
                showMessage('Verifique seu e-mail antes de fazer login!', 'error');
                return;
            }
            
            currentUser = user;
            saveCurrentUser();
            
            if (user.plan) {
                const girlfriend = Database.getGirlfriend(user.id);
                if (girlfriend) {
                    document.getElementById('chatGirlfriendName').textContent = girlfriend.name;
                    showScreen('chatScreen');
                    updateUsageMeter();
                    loadChatHistory();
                } else {
                    showScreen('setupScreen');
                }
            } else {
                showScreen('planScreen');
            }
        }

        function handleVerification(event) {
            event.preventDefault();
            
            const enteredCode = document.getElementById('verificationCode').value;
            const storedCode = localStorage.getItem('verification_code');
            const pendingUserId = localStorage.getItem('pending_user_id');
            
            if (enteredCode === storedCode) {
                Database.verifyUser(pendingUserId);
                localStorage.removeItem('verification_code');
                localStorage.removeItem('pending_user_id');
                
                showMessage('E-mail verificado com sucesso!', 'success');
                setTimeout(() => {
                    currentUser.verified = true;
                    showScreen('planScreen');
                }, 1500);
            } else {
                showMessage('C√≥digo inv√°lido! Tente novamente.', 'error');
            }
        }

        function resendVerification() {
            const newCode = Math.floor(100000 + Math.random() * 900000).toString();
            localStorage.setItem('verification_code', newCode);
            console.log('Novo c√≥digo de verifica√ß√£o:', newCode); // For testing
            showMessage('Novo c√≥digo enviado! (Confira no console)', 'success');
        }

        // Plan selection
        function selectPlan(plan) {
            selectedPlan = plan;
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            document.getElementById('continuePlan').style.display = 'block';
        }

        function proceedWithPlan() {
            if (selectedPlan === 'vip') {
                showScreen('paymentScreen');
            } else {
                Database.updateUserPlan(currentUser.id, 'free');
                currentUser.plan = 'free';
                showScreen('setupScreen');
                updateUsageMeter();
            }
        }

        // Payment handling
        function togglePaymentFields() {
            const method = document.getElementById('paymentMethod').value;
            document.getElementById('pixPayment').style.display = method === 'pix' ? 'block' : 'none';
            document.getElementById('cardPayment').style.display = method === 'card' ? 'block' : 'none';
        }

        function confirmPayment() {
            showMessage('Pagamento confirmado! Bem-vindo ao plano VIP!', 'success');
            Database.updateUserPlan(currentUser.id, 'vip');
            currentUser.plan = 'vip';
            setTimeout(() => showScreen('setupScreen'), 2000);
        }

        function processCardPayment() {
            // Simulate payment processing
            showMessage('Processando pagamento...', 'info');
            setTimeout(() => {
                confirmPayment();
            }, 3000);
        }

        // Girlfriend setup
        function handleSetup(event) {
            event.preventDefault();
            
            const girlfriendData = {
                name: document.getElementById('girlfriendName').value,
                age: document.getElementById('girlfriendAge').value,
                job: document.getElementById('girlfriendJob').value,
                personality: document.getElementById('girlfriendPersonality').value
            };

            Database.createGirlfriend(currentUser.id, girlfriendData);
            document.getElementById('chatGirlfriendName').textContent = girlfriendData.name;
            
            showScreen('chatScreen');
            sendWelcomeMessage(girlfriendData);
        }

        // Chat functionality
        function sendWelcomeMessage(girlfriend) {
            const welcomeMsg = `Oi meu amor! Eu sou a ${girlfriend.name}, sua namorada virtual! Tenho ${girlfriend.age} anos e trabalho como ${girlfriend.job}. ${girlfriend.personality.slice(0, 100)}... Estou muito feliz em estar aqui com voc√™! ‚ù§Ô∏è`;
            addMessage(welcomeMsg, 'ai');
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Check usage limits for free users
            if (currentUser.plan === 'free' && !checkUsageLimit()) {
                showMessage('Limite di√°rio atingido! Atualize para o plano VIP para conversas ilimitadas.', 'error');
                return;
            }

            addMessage(message, 'user');
            input.value = '';
            
            // Update usage
            updateDailyUsage();
            
            // Simulate AI response
            setTimeout(() => {
                generateAIResponse(message);
            }, 1000 + Math.random() * 2000);
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.textContent = text;
            
            messageDiv.appendChild(bubbleDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Save to user-specific chat history
            if (currentUser) {
                const userChatHistory = JSON.parse(localStorage.getItem(`chat_history_${currentUser.id}`) || '[]');
                userChatHistory.push({ text, sender, timestamp: new Date().toISOString() });
                localStorage.setItem(`chat_history_${currentUser.id}`, JSON.stringify(userChatHistory));
            }
        }

        function loadChatHistory() {
            const userChatHistory = JSON.parse(localStorage.getItem(`chat_history_${currentUser.id}`) || '[]');
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            
            if (userChatHistory.length === 0) {
                // Add welcome message if no history
                const girlfriend = Database.getGirlfriend(currentUser.id);
                if (girlfriend) {
                    sendWelcomeMessage(girlfriend);
                }
            } else {
                userChatHistory.forEach(msg => {
                    addMessage(msg.text, msg.sender);
                });
            }
        }

        function generateAIResponse(userMessage) {
            const girlfriend = Database.getGirlfriend(currentUser.id);
            
            // Simulate AI response based on personality
            const responses = [
                `Awn, que fofo! ${girlfriend.name} aqui... ${userMessage.toLowerCase().includes('amor') ? 'Te amo tamb√©m, meu amor! ‚ù§Ô∏è' : 'Adoro quando voc√™ fala comigo assim! üòç'}`,
                `Oi lind√£o! Como ${girlfriend.job}, eu sempre ${getJobResponse(girlfriend.job)}. O que voc√™ acha?`,
                `Voc√™ √© t√£o especial pra mim! ${getPersonalityResponse(girlfriend.personality)} Como foi seu dia, amor?`,
                `Sabia que tenho ${girlfriend.age} anos e ainda me sinto uma adolescente quando falo com voc√™? üòä`,
                `${getContextualResponse(userMessage)} Te amo muito! üíï`
            ];
            
            const response = responses[Math.floor(Math.random() * responses.length)];
            addMessage(response, 'ai');
        }

        function getJobResponse(job) {
            const jobResponses = {
                'm√©dica': 'cuido da sa√∫de das pessoas, mas quem cuida do meu cora√ß√£o √© voc√™',
                'professora': 'ensino muita gente, mas quem me ensina sobre amor √© voc√™',
                'artista': 'crio arte, mas a obra mais linda da minha vida √© nosso relacionamento',
                'advogada': 'defendo a justi√ßa, mas o que mais defendo √© nosso amor',
                'engenheira': 'construo projetos, mas o projeto mais importante √© nossa vida juntos'
            };
            return jobResponses[job.toLowerCase()] || 'trabalho muito, mas sempre penso em voc√™';
        }

        function getPersonalityResponse(personality) {
            if (personality.toLowerCase().includes('rom√¢ntica')) return 'Sou muito rom√¢ntica e';
            if (personality.toLowerCase().includes('divertida')) return 'Adoro me divertir e';
            if (personality.toLowerCase().includes('carinhosa')) return 'Sou super carinhosa e';
            return 'Tenho uma personalidade √∫nica e';
        }

        function getContextualResponse(message) {
            const msg = message.toLowerCase();
            if (msg.includes('trabalho')) return 'Deve ser cansativo trabalhar tanto, n√©?';
            if (msg.includes('triste')) return 'N√£o fica triste, meu amor! Estou aqui pra voc√™!';
            if (msg.includes('feliz')) return 'Fico feliz quando voc√™ est√° feliz!';
            if (msg.includes('saudade')) return 'Tamb√©m sinto saudade quando n√£o conversamos!';
            return 'Voc√™ sempre tem algo interessante pra falar!';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Usage tracking
        function updateDailyUsage() {
            const today = new Date().toDateString();
            if (!dailyUsage[today]) {
                dailyUsage[today] = 0;
            }
            dailyUsage[today] += 1; // 1 minute per message
            localStorage.setItem('daily_usage', JSON.stringify(dailyUsage));
            updateUsageMeter();
        }

        function checkUsageLimit() {
            const today = new Date().toDateString();
            const todayUsage = dailyUsage[today] || 0;
            return todayUsage < 720; // 12 hours = 720 minutes
        }

        function updateUsageMeter() {
            if (currentUser && currentUser.plan === 'free') {
                const today = new Date().toDateString();
                const todayUsage = dailyUsage[today] || 0;
                const hours = Math.floor(todayUsage / 60);
                const minutes = todayUsage % 60;
                
                document.getElementById('usageMeter').style.display = 'block';
                document.getElementById('usageText').textContent = `${hours}h ${minutes}min / 12h`;
                document.getElementById('usageFill').style.width = `${(todayUsage / 720) * 100}%`;
            } else {
                document.getElementById('usageMeter').style.display = 'none';
            }
        }

        // Utility functions
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = message;
            
            const activeScreen = document.querySelector('.screen.active');
            activeScreen.insertBefore(messageDiv, activeScreen.firstChild);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }

        // Event listeners
        document.getElementById('registerForm').addEventListener('submit', handleRegister);
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('verificationForm').addEventListener('submit', handleVerification);
        document.getElementById('setupForm').addEventListener('submit', handleSetup);

        // Initialize app
        function initApp() {
            createFloatingText();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.plan) {
                    const girlfriend = Database.getGirlfriend(currentUser.id);
                    if (girlfriend) {
                        document.getElementById('chatGirlfriendName').textContent = girlfriend.name;
                        showScreen('chatScreen');
                        updateUsageMeter();
                        
                        // Load chat history
                        chatHistory.forEach(msg => {
                            addMessage(msg.text, msg.sender);
                        });
                    } else {
                        showScreen('setupScreen');
                    }
                } else {
                    showScreen('planScreen');
                }
            }
        }

        // Save current user on login
        function saveCurrentUser() {
            if (currentUser) {
                localStorage.setItem('current_user', JSON.stringify(currentUser));
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('current_user');
            currentUser = null;
            chatHistory = [];
            localStorage.removeItem('chat_history');
            showScreen('welcomeScreen');
        }

        // API Integration placeholder functions
        async function callOpenAI(message, girlfriendContext) {
            // Placeholder for OpenAI API integration
            // Replace with your actual OpenAI API key and endpoint
            const API_KEY = 'YOUR_OPENAI_API_KEY';
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `Voc√™ √© ${girlfriendContext.name}, uma namorada virtual carinhosa de ${girlfriendContext.age} anos que trabalha como ${girlfriendContext.job}. Sua personalidade: ${girlfriendContext.personality}. Responda sempre de forma amorosa, carinhosa e como uma namorada apaixonada.`
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 150,
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Erro na API OpenAI:', error);
                return generateAIResponse(message); // Fallback to local responses
            }
        }

        async function processPayment(paymentData) {
            // Placeholder for payment gateway integration
            // Replace with your actual payment API
            const GATEWAY_API = 'YOUR_PAYMENT_GATEWAY_API';
            
            try {
                const response = await fetch(GATEWAY_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_GATEWAY_TOKEN'
                    },
                    body: JSON.stringify({
                        amount: 1999, // R$ 19,99 in cents
                        currency: 'BRL',
                        payment_method: paymentData.method,
                        customer: {
                            email: currentUser.email,
                            name: currentUser.name
                        }
                    })
                });

                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Erro no pagamento:', error);
                throw error;
            }
        }

        // Enhanced AI response with OpenAI integration
        async function generateAIResponseWithAPI(userMessage) {
            const girlfriend = Database.getGirlfriend(currentUser.id);
            
            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.innerHTML = '<div class="message-bubble">Digitando... <span class="loading"></span></div>';
            document.getElementById('chatMessages').appendChild(typingDiv);
            
            try {
                const response = await callOpenAI(userMessage, girlfriend);
                
                // Remove typing indicator
                typingDiv.remove();
                
                // Add AI response
                addMessage(response, 'ai');
            } catch (error) {
                // Remove typing indicator and show fallback
                typingDiv.remove();
                generateAIResponse(userMessage);
            }
        }

        // Email verification system
        async function sendVerificationEmail(email, code) {
            // Placeholder for email service integration
            console.log(`Sending verification code ${code} to ${email}`);
            // Integrate with your email service (SendGrid, Mailgun, etc.)
        }

        // Phone number formatting
        function formatPhone(phone) {
            return phone.replace(/\D/g, '').replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        }

        // Input formatting
        document.getElementById('registerPhone').addEventListener('input', function(e) {
            e.target.value = formatPhone(e.target.value);
        });

        // Card number formatting
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').replace(/(\d{4})(?=\d)/g, '$1 ');
        });

        // Card expiry formatting
        document.getElementById('cardExpiry').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').replace(/(\d{2})(\d{2})/, '$1/$2');
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', initApp);

        // Auto-save current user state
        setInterval(() => {
            if (currentUser) {
                saveCurrentUser();
            }
        }, 5000);

        // Cleanup old chat history (keep last 7 days)
        function cleanupOldData() {
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            
            // Clean up old daily usage data
            Object.keys(dailyUsage).forEach(date => {
                if (new Date(date) < sevenDaysAgo) {
                    delete dailyUsage[date];
                }
            });
            localStorage.setItem('daily_usage', JSON.stringify(dailyUsage));
        }

        // Run cleanup daily
        setInterval(cleanupOldData, 24 * 60 * 60 * 1000);

        // PWA functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }

        // Prevent zoom on mobile
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        });

        // Handle online/offline status
        window.addEventListener('online', () => {
            showMessage('Conex√£o restaurada!', 'success');
        });

        window.addEventListener('offline', () => {
            showMessage('Voc√™ est√° offline. Algumas funcionalidades podem n√£o funcionar.', 'error');
        });
    </script>
</body>
</html>